{"type":"data","nodes":[null,{"type":"data","data":[{"repoDetails":1,"readme":20,"meta":21},{"id":2,"name":3,"user":4,"url":5,"description":6,"isFork":7,"createdAt":8,"updatedAt":9,"homepage":10,"language":11,"license":10,"size":12,"stars":13,"forks":14,"issues":15,"topics":16,"archived":7,"has_pages":7},972765097,"ansibles","Lissy93","https://github.com/Lissy93/ansibles","âš’ï¸ My Ansible playbooks and roles that I use to automate the configuration and management of all my servers",false,"2025-04-25T16:13:33Z","2025-05-07T19:34:09Z","","Python",146,2,1,0,[17,18,19],"ansible","server","vps","\nOBJECTIVE ðŸŽ¯\n-----------\nAfter creating a fresh new VM/VPS/server (and adding a SSH key while doing so)\nI should just be able to run one command on my PC, to have the new remote system\nperfectly setup just how I like it.\n\nThanks to Ansible, everything is nice 'n easy, automated, repeatable and safe ðŸ˜Š\nSo all my fresh machines can be correctly configured, secured, backed up, and\nactually usable and ready to go!\n\nI've documented the playbooks, usage guide and some info about Ansible below...\n\n================================================================================\n\nJOBS ðŸ‘”\n-------\nâž¡ï¸ RECOMMENDED TASKS:\n âš’ï¸ Essentials:\n  â”œâ”€â”€ âœ… Apt - Configures repositories and updates packages\n  â”œâ”€â”€ âœ… Packages - Installs essential packages\n  â”œâ”€â”€ âœ… User accounts - Creates user(s) and sets permissions\n  â”œâ”€â”€ âœ… SSH - Configures and hardens SSH access\n  â”œâ”€â”€ âœ… Timezone - Sets timezone and NTP server\n  â”œâ”€â”€ âœ… Hostname - Sets hostname and configures hosts\n  â”œâ”€â”€ âœ… Firewall - Sets UFW rules\n  â”œâ”€â”€ âœ… Mail - Sets up Postfix (for notification sending)\n  â””â”€â”€ âœ… Updates - Enables unattended upgrades\n\nâž¡ï¸ OPTIONAL TASKS:\n âš™ï¸ Configs:\n  â”œâ”€â”€ â˜‘ï¸ Packages - Installs extra packages, for easier management\n  â””â”€â”€ â˜‘ï¸ Dotfiles - Configures settings for CLI utils and apps\n\n ðŸ’¾ Backups\n  â””â”€â”€ â˜‘ï¸ Backups - Sets up automated, encrypted, incremental Borg backups\n\n ðŸ”‘ Access:\n  â”œâ”€â”€ â˜‘ï¸ VPN - Sets up and secures Wireguard VPN\n  â””â”€â”€ â˜‘ï¸ Cockpit - Sets up Cockpit for easy management via UI\n\n ðŸ–¥ï¸ Apps and Services\n  â”œâ”€â”€ â˜‘ï¸ Docker - Installs and configures Docker (if needed)\n  â””â”€â”€ â˜‘ï¸ Proxy - Sets up Caddy (only if not using Docker)\n\n ðŸ”’ Security:\n  â”œâ”€â”€ â˜‘ï¸ System hardening - Implements some DevSec security baselines\n  â”œâ”€â”€ â˜‘ï¸ AppArmor - Sets up profiles for process confinement\n  â”œâ”€â”€ â˜‘ï¸ Intrusion detection - Configures Fail2ban to block brute-force\n  â”œâ”€â”€ â˜‘ï¸ Integrity monitoring - Sets up and automates OSSEC\n  â”œâ”€â”€ â˜‘ï¸ Malware scanning - Sets up daily Maldet scans and reporting\n  â””â”€â”€ â˜‘ï¸ Security audits - Enables daily Lynis audits and reporting\n\n ðŸ“Š Monitoring:\n  â”œâ”€â”€ â˜‘ï¸ Log storage â€“ Loki for ingesting and aggregating all logs\n  â”œâ”€â”€ â˜‘ï¸ Log shipping â€“ Grafana Agent, pushes logs and metrics to Loki\n  â”œâ”€â”€ â˜‘ï¸ Metrics collection â€“ Grafana Agent, pushing metrics into Prometheus\n  â”œâ”€â”€ â˜‘ï¸ Metrics storage â€“ Prometheus for storing and querying metrics\n  â”œâ”€â”€ â˜‘ï¸ Visualization â€“ Grafana for dashboards from Loki and Prometheus\n  â”œâ”€â”€ â˜‘ï¸ Alerting â€“ Alertmanager for triggering critical notifications\n  â”œâ”€â”€ â˜‘ï¸ Log rotation - Sets up logrotate for all logs, so they don't get big\n  â””â”€â”€ â˜‘ï¸ Monit - Monitors services and restarts them if they fail\n\nNote about Docker:\nOn servers where Docker is used for deploying services, some of the apps above\ncan/will be skipped. Such as Caddy, Grafana and Alertmanager\nBecause it's better to run them in containers instead of directly on the host.\nFor the Docker stacks, see my compose in: https://github.com/Lissy93/dockyard\n\n================================================================================\n\nUSAGE ðŸ› ï¸\n--------\nSTEP 0: PREREQUISITES\n- Ensure Python (3.8+) and Ansible are installed (2.18+) on your local system\n- Fetch external roles: `ansible-galaxy install -r requirements.yml`\n- Create a new remote server (if u like). And ensure you have SSH access to it\n\nSTEP 1: SERVERS\n- Add servers. Create `inventories/remote.yml`\n\nSTEP 2: CONFIGURATION\n- Add variables to `inventories/group_vars/remote.yml` or `all.yml` (shared)\n- Best to put secrete variables in an Ansible vault (see instructions below)\n\nSTEP 4: RUNNING\n- Use the commands in the Makefile to execute the playbooks.\n  - First run: `make first-run`\n  - Subsequent runs: `make run`\n\n================================================================================\n\nCOMMANDS ðŸ’²\n-----------\nBasics:\n- `make` - View all available commands and our man page\n- `make run` - Run all playbooks (as normal user with new SSH settings)\n- `make \u003Crole>` - Run a specific role (e.g. `make ssh`)\n- `make \u003Cplaybook>` - Run a specific playbook (e.g. `make security`)\n\nSetup:\n- `make install-ansible` - Install Ansible (on host)\n- `make requirements` - Downloads external roles from Ansible Galaxy\n- `make scaffold-hosts` - Creates inventory template (for you to fill in)\n- `make first-run` - First run on a fresh server (as root)\n\nOther:\n- `make lint` - Run Ansible-lint on all playbooks and roles\n- `make docs` - Generates documentation for roles and playbooks\n- `make test` - Runs all tests on playbooks and hosts\n\nNative Ansible Commands:\n- Run a playbook on specific servers:\n  > ansible-playbook -i inventories/\u003Chosts>.yml playbooks/\u003Cplaybook>.yml\n- Run only roles with a specific tag:\n  > ansible-playbook -i inventories/\u003Chosts>.yml playbooks/\u003Cplay>.yml --tags \u003Ctag>\n- Run a playbook on a specific server:\n  > ansible-playbook -i inventories/\u003Chosts>.yml playbooks/\u003Cplay>.yml -l \u003Cservers>\n- Do a dry-run, and preview what changes will be made before applying:\n  > ansible-playbook -i inventories/\u003Chosts>.yml playbooks/\u003Cplay>.yml --check --diff\n- Run an ad-hoc command on servers in an inventory:\n  > ansible db -i inventories/\u003Chosts>.yml -m shell -a \"\u003Cshell command>\"\n\n================================================================================\n\nADDING SERVERS ðŸ–¥ï¸\n-----------------\nDefine your list of hosts (servers to manage) in the inventory file(s).\nThe path which ansible looks for hosts in, is specified in ./ansible.cfg\nIf it's your first time, you can run `make scaffold-hosts` to create a template\nThen complete the values in .inventories/production/hosts.yml, like this:\n\nall:\n  hosts:\n    my-server:\n      ansible_host: 111.111.111.111\n      ansible_user: bob\n      ansible_python_interpreter: /usr/bin/python3\n    my-other-server:\n      ansible_host: 000.000.000.000\n      ansible_user: alice\n      ansible_port: 22\n      ansible_python_interpreter: /usr/bin/python3\n\n================================================================================\n\nADDING VARIABLES ðŸ—‚ï¸\n--------------------\n- Defaults are defined per-role in: ./roles/\u003Crole_name>/defaults/main.yml\n- But you can (and should) override in:  ./inventories/group_vars/all.yml\n- Or, set host-specific vars, in:  ./inventories/host_vars/\u003Chostname>.yml\n- Secrets should be stored in a vault: ./inventories/group_vars/vault.yml\n  1. Create a vault: `ansible-vault create ./inventories/group_vars/vault.yml`\n  2. Edit the vault: `ansible-vault edit ./inventories/group_vars/vault.yml`\n  3. Use the vault by adding the `--ask-vault-pass` flag when running a playbook\n\n================================================================================\n\nWHAT'S ANSIBLE, AND WHY USE IT? â“\n----------------------------------\nAnsible is a simple, open source, agentless tool for automating anything.\nJust describe how you want your system to look, and Ansible will ensure\nthe state is met.\n\n10 Reasons why I love Ansible\nUnlike Bash scripts or other alternatives...\n1. Ansible is idempotent, so you can run it as many times as you like,\n   and it will only make changes if the system is not in the desired state.\n2. Ansible is agentless, there's nothing to install on any of your systems.\n3. Ansible is declarative, you don't have to worry about the order of operations.\n4. Ansible is reusable and x-platform. Write playbooks once, run them anywhere.\n5. Ansible is scalable. Run it on a single host or thousands of servers at once.\n6. Ansible is extensible. There's thousands of playbooks on Galaxy,\n   or you can write your own modules in any language you want.\n7. Ansible is simple. No finicky scripts, just self-documenting YAML declarations.\n8. Ansible is powerful. Doing anything from simple tasks to complex orchestration.\n9. Ansible is safe. Preview changes to be made (--diff), or do a dry-run (--check)\n10. Ansible is configurable. Use built-in or custom 'facts' to customize playbooks.\n\nRead the Ansible docs at:\nhttps://docs.ansible.com/ansible/latest/getting_started/introduction.html\n\n================================================================================\n\nANSIBLE BASICS ðŸ“š\n-----------------\nTerminology:\n- Inventories = Who to configure (a list of hosts/servers)\n- Playbooks = What to do (at a high level, collection of roles)\n- Roles = Reusable collections of logic, made up of tasks\n- Tasks = The actual code that Ansible runs (usually YAML)\n- Plugins = Reusable code snippets (usually Python) that extend Ansible\n- Vars = Variables used to specify values for each playbook/role/task\n- ansible.cfg = The config file that tells Ansible where to find things\n\nStructure:\nAnsible projects follow a specific directory structure, as illustrated below:\nThe top-level directories are:\n- inventories/ - Where you list the hosts/servers that changes will be applied to\n- playbooks/ - The playbooks that run the roles, and define the order of execution\n- roles/ - The individual roles, made up of tasks, handlers, and other files\n\nThis is the structure of my project:\n\n.\nâ”œâ”€â”€ ansible.cfg           # Config: inventory paths, plugin dirs, etc\nâ”œâ”€â”€ callback_plugins/     # Custom Ansible callback plugins\nâ”‚   â””â”€â”€ pretty.py         # Emoji & color stdout formatting\nâ”œâ”€â”€ inventories/          # Host/group definitions and vars\nâ”‚   â””â”€â”€ production/       # Remote production inventory\nâ”‚       â”œâ”€â”€ hosts.yml     # Inventory host list\nâ”‚       â”œâ”€â”€ group_vars/   # Variables applied by group\nâ”‚       â”‚   â””â”€â”€ all.yml   # Variables to be shared by all servers in this group\nâ”‚       â””â”€â”€ host_vars/    # Per-host variables\nâ”‚           â””â”€â”€ serv1.yml # Example: Add a file for each of your servers\nâ”œâ”€â”€ Makefile              # Shortcut targets for playbook runs\nâ”œâ”€â”€ playbooks/            # Playbooks invoking roles by concern\nâ”‚   â”œâ”€â”€ all.yml           # Main \"run everything\" playbook\nâ”‚   â”œâ”€â”€ access.yml        # VPN & Cockpit setup\nâ”‚   â”œâ”€â”€ backups.yml       # Borg backup tasks\nâ”‚   â”œâ”€â”€ configs.yml       # General configuration tasks\nâ”‚   â”œâ”€â”€ essentials.yml    # Core hardening, compliance, audits\nâ”‚   â”œâ”€â”€ monitoring.yml    # Loki, Prometheus & Grafana setup\nâ”‚   â”œâ”€â”€ security.yml      # Fail2ban, OSSEC, Maldet, Lynis, AppArmor\nâ”‚   â””â”€â”€ services.yml      # Docker, Caddy proxy, and other services\nâ”œâ”€â”€ readme.txt            # Project overview & usage instructions\nâ”œâ”€â”€ requirements.yml      # Galaxy roles/collections to install\nâ””â”€â”€ roles/                # Reusable Ansible roles (one dir per role)\n    â”œâ”€â”€ apparmor          # AppArmor profile deployment\n    â”œâ”€â”€ blackbox_exporter # Prometheus Blackbox Exporter\n    â”œâ”€â”€ borg              # Automated Borg backups\n    â”œâ”€â”€ cockpit           # Cockpit management UI\n    â”œâ”€â”€ directories       # Directory structure setup\n    â”œâ”€â”€ docker            # Docker engine install & config\n    â”œâ”€â”€ dotfiles          # User dotfiles deployment\n    â”œâ”€â”€ fail2ban          # Intrusion-detection rules\n    â”œâ”€â”€ firewall          # UFW firewall configuration\n    â”œâ”€â”€ geerlingguy.docker# Docker setup, from geerlingguy\n    â”œâ”€â”€ geerlingguy.pip   # Pip/Python setup, from geerlingguy\n    â”œâ”€â”€ grafana           # Grafana install, config & provisioning\n    â”œâ”€â”€ grafana-agent     # Grafana Agent setup & metrics checks\n    â”œâ”€â”€ hostname          # Hostname & /etc/hosts management\n    â”œâ”€â”€ installs          # Miscellaneous package installs\n    â”œâ”€â”€ logrotate         # Logrotate config and templates\n    â”œâ”€â”€ loki              # Loki log-aggregation setup\n    â”œâ”€â”€ lynis             # Automated Lynis security audits\n    â”œâ”€â”€ maldet            # Linux Malware Detect integration\n    â”œâ”€â”€ monit             # Service monitoring with Monit\n    â”œâ”€â”€ node_exporter     # Prometheus Node Exporter\n    â”œâ”€â”€ prometheus        # Prometheus server setup & config\n    â”œâ”€â”€ ssh               # SSH hardening & key management\n    â”œâ”€â”€ tailscale         # Tailscale VPN installation\n    â”œâ”€â”€ timezone          # Timezone & NTP configuration\n    â””â”€â”€ users             # User account & permission management\n\n================================================================================\n\nTROUBLESHOOTING ðŸ«¨\n------------------\n1. Ansible requires the locale encoding to be UTF-8; Detected None.\n    - Fix: set `export LC_ALL=`\n    - Or run `locale -a` to see your locales and set with `LC_ALL='en_US.UTF-8'`\n\n2. Failed to connect to the host via ssh\n    - Ensure you have run `make initial-apply` before running `make apply`\n    - Check the ansible_user and ansible_host variables in your inventory file\n    - Check SSH access to the server. Ensure you can SSH in manually.\n\n3. The task includes an option with an undefined variable.. '___' is undefined\n    - Define that variable in `./inventories/group_vars/all.yml` or elsewhere\n\n4. Unable to encrypt nor hash, passlib must be installed\n    - Install passlin, with: `pip install passlib`\n\n5. YAML syntax or Jinja2 template errors\n    - Check your YAML syntax with: `yamllint \u003Cfile>.yml`\n    - Check your Jinja2 with: `ansible-playbook --syntax-check \u003Cplaybook>.yml`\n\n6. The role 'foo' was not found\n    - Install external roles with: `ansible-galaxy install -r requirements.yml`\n    - And double check the `roles_path` and `collections_paths` in ansible.cfg\n\n7. Help, my terminal is full of talking cows!\n    - This happens because you have `cowsay` installed ðŸ®ðŸ˜‰\n    - Just set: `nocows=1` in your ansible.cfg file\n\n================================================================================\n\nWARNING âš ï¸\n----------\nShould you use this? ...Probably not.\nBecause it's really easy to create your own Ansible playbooks,\nand they will be better tailored to your specific needs.\n(Also I don't much want to be responsible if something goes wrong! ðŸ«£)\n\nBut feel free to use or copy-paste which ever parts you like into your setup ðŸ«¶\n\nIMPORTANT: Read through the playbooks and roles before running them.\nAnd make sure you understand what they do, to avoid any surprises!\n\n================================================================================\n\nLICENSE ðŸ“ƒ\n----------\nDO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE  [Version 2, December 2004]\nCopyright (C) 2025 Alicia Sykes \u003Caliciasykes.com>\n\nEveryone is permitted to copy and distribute verbatim or modified \ncopies of this license document, and changing it is allowed as long \nas the name is changed. \n\nTERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION \n0. You just do whatever the fuck you want to\n",{"name":3,"title":22,"language":17,"description":23,"icon":24,"screenshot":25,"color":26},"Ansible Playbooks","Full, automated, configurable server setup for optimum usability, security and best practices","https://storage.googleapis.com/as93-screenshots/project-logos/ansibles.png","https://storage.googleapis.com/as93-screenshots/project-screenshots/ansibles.gif","#d95de8"],"uses":{"params":["repo"]}}]}
